<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Blog Application</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .posts {
            display: flex;
            flex-wrap: wrap;
        }

        .post-summary {
            margin: 10px;
            padding: 15px;
            border: 1px solid #ddd;
            width: calc(33% - 20px);
            box-sizing: border-box;
            cursor: pointer;
        }

        .post-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .excerpt {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .post-info {
            display: flex;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .post-tags {
            display: flex;
            flex-wrap: wrap;
        }

        .post-tags-info {
            display: flex;
            flex-wrap: wrap;
            background-color: #eee;
            padding: 2px 5px;
            margin: 5px;
            border-radius: 5px;
            font-size: 12px;
        }

        .accordion-toggle {
            display: none;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
        }

        #select-tags:checked~.accordion-content,
        #select-author:checked~.accordion-content {
            background-color: white;
            border: 1px solid #ddd;
            width: 200px;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
        }

        .accordion-toggle:checked+.accordion-header+.accordion-content {
            max-height: 500px;
            overflow-y: auto;
            position: absolute;
            margin: auto 20px auto 20px;
        }

        .container {
            padding: 20px;
            margin-top: 5px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .header h1 {
            margin: 0;
        }

        .header-right {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .options {
            display: flex;
            gap: 10px;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>Blog Application</h1>
        <div class="options">
            <a th:href="@{/newpost}">New Post</a>
            <form class="options" method="get">
                <div>
                    <select id="sort" name="order">
                        <option value="latest" th:selected="${order == 'latest'}">Latest</option>
                        <option value="oldest" th:selected="${order == 'oldest'}">Oldest</option>
                    </select>
                </div>

                <div class="search-login">
                    <input class="search-bar" name="search-query" th:value="${search_query}" placeholder="Search"
                        type="text" />
                </div>
                <button type="submit" th:formaction="@{/search}">Search</button>


                <div id="select-tags-section">
                    <input class="accordion-toggle" id="select-tags" type="checkbox" />
                    <label class="accordion-header" for="select-tags">Select Tags</label>
                    <div class="accordion-content">
                        <div th:each="tag : ${tags}">
                            <input name="tags" th:value="${tag}" type="checkbox"
                                th:checked="${selectedTags != null and selectedTags.contains(tag)}" />
                            <span th:text="${tag}"></span>
                        </div>
                    </div>
                </div>

                <div id="select-author-section">
                    <input class="accordion-toggle" id="select-author" type="checkbox" />
                    <label class="accordion-header" for="select-author">Select Authors</label>
                    <div class="accordion-content">
                        <div th:each="author : ${authors}">
                            <input name="authors" th:value="${author}" type="checkbox"
                                th:checked="${selectedAuthors != null and selectedAuthors.contains(author)}" />
                            <span th:text="${author}"></span>
                        </div>
                    </div>
                </div>
                <button type="submit" th:formaction="@{/filter}">Filter</button>
            </form>

            <div>
                <a href="/login">Login</a>
            </div>
        </div>
    </div>

    <div class="posts">
        <div class="post-summary" th:each="post : ${posts}">
            <form class="clickable-form" method="get" th:action="@{/{id} (id=${post.id})}">
                <div onclick="this.closest('form').submit()">
                    <h2 class="post-title" th:text="${post.title}"></h2>
                    <div class="post-info">
                        <span th:text="${post.author} + ', ' + ${post.createdAt}"></span>
                    </div>
                    <p class="post-info" th:text="${post.excerpt}"></p>
                    <div class="post-tags">
                        <span class="post-tags-info" th:each="tag : ${post.tags}" th:text="${tag.name}"></span>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Pagination controls -->
    <div id="pagination">
        <div>
            <div>
                <!-- Pagination for search -->
                <div th:if="${search_query != null and !search_query.isEmpty()}">
                    <form th:action="@{/search}" method="get">
                        <input type="hidden" name="page_number" th:value="${currentPage - 1}" />
                        <input type="hidden" name="page_size" th:value="2" />
                        <input type="hidden" name="search-query" th:value="${search_query}" />
                        <input type="hidden" name="order" th:value="${order}" />
                        <button type="submit" th:if="${currentPage > 0}">Previous</button>
                    </form>

                    <form th:action="@{/search}" method="get">
                        <input type="hidden" name="page_number" th:value="${currentPage + 1}" />
                        <input type="hidden" name="page_size" th:value="2" />
                        <input type="hidden" name="search-query" th:value="${search_query}" />
                        <input type="hidden" name="order" th:value="${order}" />
                        <button type="submit" th:if="${currentPage < totalPages - 1}">Next</button>
                    </form>

                </div>

                <!-- Pagination for filter -->
                <div
                    th:if="${selectedTags != null and !selectedTags.isEmpty() or selectedAuthors != null and !selectedAuthors.isEmpty()}">
                    <form th:action="@{/filter}" method="get">
                        <input type="hidden" name="page_number" th:value="${currentPage - 1}" />
                        <input type="hidden" name="page_size" th:value="2" />
                        <div th:each="tag : ${selectedTags}">
                            <input type="hidden" name="tags" th:value="${tag}" />
                        </div>
                        <div th:each="author : ${selectedAuthors}">
                            <input type="hidden" name="authors" th:value="${author}" />
                        </div>
                        <input type="hidden" name="order" th:value="${order}" />
                        <button type="submit" th:if="${currentPage > 0}">PREVIOUS</button>
                    </form>
                    <form th:action="@{/filter}" method="get">
                        <input type="hidden" name="page_number" th:value="${currentPage + 1}" />
                        <input type="hidden" name="page_size" th:value="2" />
                        <div th:each="tag : ${selectedTags}">
                            <input type="hidden" name="tags" th:value="${tag}" />
                        </div>
                        <div th:each="author : ${selectedAuthors}">
                            <input type="hidden" name="authors" th:value="${author}" />
                        </div>
                        <input type="hidden" name="order" th:value="${order}" />
                        <button type="submit" th:if="${currentPage < totalPages - 1}">NEXT</button>
                    </form>
                </div>

                <!-- Default Pagination -->
                <div
                    th:if="${(selectedTags == null or selectedTags.isEmpty()) and (selectedAuthors == null or selectedAuthors.isEmpty()) and (search_query == null or search_query.isEmpty())}">
                    <a th:if="${currentPage > 0}"
                        th:href="@{/(page_number=${currentPage - 1}, page_size=2)}">Previous</a>
                    <a th:if="${currentPage < totalPages - 1}"
                        th:href="@{/(page_number=${currentPage + 1}, page_size=2)}">Next</a>
                </div>
            </div>

        </div>
    </div>

</body>

</html>